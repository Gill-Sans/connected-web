<div class="calendar-container">
    <div class="calendar">
        <app-calendar
            [deadlines]="(deadlines$ | async) ?? []"
            (dayClick)="onDayClick($event)">
        </app-calendar>

    </div>

    <div class="right-sidebar">
        @if ((isTeacher$ | async)) {
            <app-button variant="primary" (click)="openCreateModal()">Create Deadline</app-button>
        }

        @if (deadlines$ | async; as deadlines) {
            <div>
                @if (deadlines.length > 0) {
                    <div class="deadline-container">
                        @for (deadline of deadlines; track deadline) {
                            <div class="deadline-card">
                                <div class="card-header">
                                    <h3>{{ deadline.title }}</h3>
                                    @if ((isTeacher$ | async)) {
                                        <i class="fa fa-trash delete-btn" (click)="openDeleteModal(deadline)"></i>
                                    }
                                </div>

                                <p class="due-date">
                                    {{ convertToTimeZone(deadline.dueDate) | date: 'EEE MMM d · HH:mm' }}
                                </p>

                                <p class="description">{{ deadline.description }}</p>

                                <span class="badge {{ deadline.restriction.toLowerCase() }}">
                  {{ deadline.restriction.replace('_', ' ').toLowerCase() }}
                </span>
                            </div>
                        }
                    </div>
                } @else {
                    <p class="empty-state">No deadlines available.</p>
                }
            </div>
        } @else {
            <p class="empty-state">Loading deadlines...</p>
        }
    </div>
</div>

<!-- Delete Confirmation Modal -->
@if (showModal) {
    <app-confirmation-modal
        [title]="'Delete Deadline'"
        [message]="'Are you sure you want to delete this deadline?'"
        [confirmText]="'Delete'"
        [cancelText]="'Cancel'"
        (confirm)="confirmDelete()"
        (cancel)="closeModal()">
    </app-confirmation-modal>
}

<!-- Create Deadline Modal -->
@if (showCreateModal) {
    <div class="modal">
        <div class="modal-content">
            <button class="close-button" (click)="closeCreateModal()">✕</button>
            <app-deadline-create
                [defaultDate]="selectedDate"
                (deadlineCreated)="onDeadlineCreated()"
                (closeModal)="closeCreateModal()">
            </app-deadline-create>
        </div>
    </div>
}
