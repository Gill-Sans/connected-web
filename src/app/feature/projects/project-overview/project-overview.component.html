<div class="project-overview">
  <div class="tab-bar">
    <div class="tabs">
      @for (tab of tabOptions; track tab) {
        <span
          class="tab"
          [class.active]="selectedTab === tab.value"
          (click)="changeTab(tab.value)"
          >
          {{ tab.label }}
        </span>
      }
    </div>
    <div class="tabs-right">
      <div class="sort-wrapper">
        <label for="project-sort">Sort by</label>
        <select
          id="project-sort"
          [ngModel]="selectedSort"
          (ngModelChange)="changeSort($event)"
        >
          @for (option of sortOptions; track option.value) {
            <option [ngValue]="option.value">
              {{ option.label }}
            </option>
          }
        </select>
      </div>
      <button
        type="button"
        class="filter-toggle-btn"
        (click)="toggleFilters()"
        [attr.aria-expanded]="showFilters"
        aria-controls="project-filters"
        aria-label="Toggle filters"
      >
        <img src="icons/filter.svg" alt="" aria-hidden="true" />
      </button>
      @if ((isTeacher$ | async)) {
        <div class="toggle-container" (click)="toggleView()">
          <div class="toggle-switch">
            <div class="toggle-highlight" [style.left]="viewType === 'card' ? '40px' : '0'"></div>
            <div class="icon icon-list">
              <img src="icons/list-solid.svg" alt="List View" />
            </div>
            <div class="icon icon-card">
              <img src="icons/projects.svg" alt="Card View" />
            </div>
          </div>
        </div>
      }

      <app-button variant="primary" (click)="navigateToProjectCreate()">Create Project</app-button>
    </div>
  </div>

  @if (showFilters) {
    <div id="project-filters" class="filters-bar">
      <div class="filter-group">
        <label for="min-free-spots">Minimum free spots</label>
        <input
          id="min-free-spots"
          type="number"
          min="0"
          [ngModel]="minFreeSpots"
          (ngModelChange)="onMinFreeSpotsChange($event)"
        />
      </div>
      <div class="filter-group status-group">
        <span class="filter-label">Status</span>
        <div class="status-options">
          @for (status of statusOptions; track status) {
            <app-statuscard
              class="status-option"
              variant="large"
              type="clickable"
              [status]="status"
              [active]="isStatusSelected(status)"
              (click)="toggleStatusFilterByClick(status)"
            ></app-statuscard>
          }
        </div>
      </div>
    </div>
  }

  <!-- Render view based on the selected viewType -->
  @if (projects$ | async; as projects) {
    <div>
      @if (projects.length > 0) {
        @if (viewType === 'card') {
          <div>
            <div class="card-container">
              @for (project of projects; track project) {
                <app-projectcard
                  [project]="project"
                ></app-projectcard>
              }
            </div>
          </div>
        } @else {
          <app-button variant="neutral" (click)="publishAllProjects()">Publish All</app-button>
          <table class="project-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Owner</th>
                <th style="width:20%">Current Status</th>
                @if (selectedTab === 'all') {
                  <th style="width:20%">Change Status</th>
                }
              </tr>
            </thead>
            <tbody>
              @for (project of projects; track project) {
                <tr>
                  <td (click)="navigateToProject(project)">{{ project.title }}</td>
                  <td>
                    {{
                    project.productOwner
                    ? project.productOwner.firstName + ' ' + project.productOwner.lastName
                    : project.createdBy.firstName + ' ' + project.createdBy.lastName
                    }}
                  </td>
                  <td>
                    <app-statuscard status="{{ project.status }}">
                      {{ project.status }}
                    </app-statuscard>
                  </td>
                  @if (selectedTab === 'all') {
                    <td>
                      <app-project-status-select
                        [value]="project.status"
                        (valueChange)="updateProjectStatus(project, $event)"
                      ></app-project-status-select>
                    </td>
                  }
                </tr>
              }
            </tbody>
          </table>
        }
      } @else {
        <div class="no-projects-message">
          No projects found
        </div>
      }
    </div>
  } @else {
    <p>Loading...</p>
  }

  <router-outlet></router-outlet>
</div>
