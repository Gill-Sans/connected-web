<div class="feedback-layout">

    <!-- LEFT: FEEDBACK THREAD -->
    <section class="feedback-column">

        @if (isTeacher$ | async) {
            <form class="feedback-form" [formGroup]="feedbackForm" (ngSubmit)="submitFeedback()">
                <textarea formControlName="feedback" placeholder="Write your feedback..."></textarea>
                <app-button variant="primary" type="submit" [disabled]="feedbackForm.invalid">Post</app-button>
            </form>
        }

        <div class="feedback-list">
            @if (feedbackList$ | async; as feedbackList) {
                @for (feedback of feedbackList; track feedback) {
                    <app-conversationcard
                        [firstName]="feedback.user.firstName"
                        [lastName]="feedback.user.lastName"
                        [createdAt]="feedback.createdAt"
                        [comment]="feedback.comment"
                        [feedbackId]="feedback.id"
                        [isEditing]="editingFeedback?.id === feedback.id"
                        [showEditDelete]="(isTeacher$ | async) || false"
                        (edit)="updateFeedback(feedback)"
                        (delete)="deleteFeedback(feedback)"
                        (confirmEdit)="confirmEdit($event.id, $event.comment)"
                        (cancelEdit)="cancelEdit(feedback.id)">
                    </app-conversationcard>
                }
            } @else {
                <p class="loading">Loading feedback...</p>
            }
        </div>

    </section>

    <!-- RIGHT: TEACHER REVIEW ASIDE -->
    @if (isTeacher$ | async) {
        <aside class="review-column">
            <span class="teacher-only-label">Teacher Only</span>
            <h4>Review</h4>

            <div class="review-actions">
                <button class="thumb-btn" (click)="updateReviewStatus('thumbs_up')" title="Thumbs Up">
                    <i class="fa fa-thumbs-up up"></i>
                </button>
                <button class="thumb-btn" (click)="updateReviewStatus('thumbs_down')" title="Thumbs Down">
                    <i class="fa fa-thumbs-down down"></i>
                </button>
            </div>

            <div class="review-list">
                @if (reviewList$ | async; as reviewList) {
                    @for (review of reviewList; track review) {
                        <div class="review-item">
                            <span>{{ review.reviewer.firstName }} {{ review.reviewer.lastName }}</span>
                            <i class="fa" [ngClass]="review.status === 'THUMBS_UP' ? 'fa-thumbs-up up' : 'fa-thumbs-down down'"></i>
                        </div>
                    }
                }
            </div>
        </aside>
    }

</div>
