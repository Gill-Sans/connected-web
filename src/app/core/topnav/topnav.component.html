<div class="topnav">
  <div class="left" *hasRole="[Role.Teacher, Role.Student]">
    <div class="left-content" (click)="toggleAssignmentsHidden()" (clickOutside)="closeAssignmentsDropdown()">
      <div class="course-icon"></div>
      @if (activeAssignment$ | async; as active) {
        <div class="course-info">
          <p class="assignment-name">{{ active.assignment.name }}</p>
          <p class="course-name">{{ active.course.name }}</p>
        </div>
      } @else {
        <div class="course-info">
          <p class="assignment-name">No assignment selected</p>
          <p class="course-name">select an assignment to get started</p>
        </div>
      }
      <img alt="Dropdown" class="dropdown-icon" src="icons/dropdown.svg"/>
    </div>
    <div [hidden]="isHiddenAssignments" class="dropdown">
      @if (courses$ | async; as courses) {
        <dl>
          @for (course of courses; track course) {
            <div class="course">
              <dt>{{ course.name }}</dt>
              @for (assignment of course.assignments; track assignment) {
                <dd (click)="selectAssignment(assignment, course)"
                  [ngClass]="{'selected': (activeAssignment$ | async)?.assignment?.id === assignment.id}">
                  {{ assignment.name }}
                </dd>
              }
            </div>
          }
        </dl>
      } @else {
        Loading Assignments...
      }
    </div>
  </div>@if(true) {
  @if (user$ | async; as user) {
    <div class="right">
      <div class="nav-icons">
        <div class="notifications" (clickOutside)="closeNotifications()" (click)="toggleNotifications()">
          <div class="notifications-container">
            <div class="notification-icon">
              <img
                src="icons/bell-regular.svg"
                alt="Notifications"
                />
                @if (notifications$ | async; as notifications) {
                  <span class="notifications-badge">
                    {{ notifications.length }}
                  </span>
                }
              </div>
              <div
                class="notifications-dropdown"
                [ngClass]="{'hidden': isHiddenNotifications}"
                >
                @if (notifications$ | async; as notifications) {
                  @for (notification of notifications; track notification) {
                    <div class="notification-item">
                      <div class="notification-content" (click)="navigateToNotification(notification)">
                        @if (!notification.isRead) {
                          <div class="unread-dot"></div>
                        }
                        <div class="notification-text">
                          <p>{{ notification.message }}</p>
                          <span
                          class="notification-date">{{ notification.timestamp | date:'short' }}</span>
                        </div>
                      </div>
                      <div class="delete-notification">
                        <button (click)="deleteNotification(notification.notificationId)">
                          <img src="icons/delete-icon.svg" alt="Delete notification"/>
                        </button>
                      </div>
                    </div>
                  }
                  @if (notifications.length === 0) {
                    <div class="no-notifications">
                      No notifications
                    </div>
                  }
                }
              </div>
            </div>
          </div>
          <div class="user-icon" (click)="toggleHiddenprofile()" (clickOutside)="closeProfileDropdown()">
            <img [src]="user.profileImageUrl" alt="avatar">
          </div>
          <div class="dropdownProfile" [hidden]="isHiddenProfile">
            <ul>
              <li class="user-name">{{user.firstName}} {{user.lastName}}</li>
              <li (click)="navigateToSettings()">Settings</li>
              <li (click)="navigateToProfile()">My profile</li>
              <li (click)="logout()">Log out</li>
            </ul>
          </div>
        </div>
      </div>
    }
  }
</div>
